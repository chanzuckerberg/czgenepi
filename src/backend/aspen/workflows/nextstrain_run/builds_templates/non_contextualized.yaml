inputs:
  - name: "root_ref"
    metadata: "data/references_metadata.tsv"
    sequences: "data/references_sequences.fasta"
  - name: "gisaid"
    metadata: "data/metadata_gisaid.tsv"
    sequences: "data/sequences_gisaid.fasta"
  - name: "aspen"
    metadata: "data/metadata_aspen.tsv"
    sequences: "data/sequences_aspen.fasta"

builds:
  aspen:
    country: USA
    division: {division}
    location: {location}
    region: North America
    subsampling_scheme: group_only
    title: '{location}, {division} samples, non-contextualized tree'

## custom rules
custom_rules:
  - nextstrain_profiles/nextstrain-gisaid/subsampling_ranges.smk

## Auxiliary files
files:
  include: "data/include.txt"
  lat_longs: "my_profiles/aspen/lat_longs.tsv"
  ordering: "my_profiles/aspen/ordering.tsv"
  description: "my_profiles/aspen/description_non_contextualized.md"
  auspice_config: "my_profiles/aspen/aspen_auspice_config_v2.json"

## Parameters
refine:
  keep_polytomies: True
  clock_filter_iqd: 3
crowding:
  crowding_penalty: 0.1

## Subsampling schemas
subsampling:
  group_only:
    root:
      exclude: "--exclude-where 'root_ref!=yes'"

    same_county:
      group_by: "year month"
      max_sequences: 2000
      query: --query "(location == '{{location}}') & (division == '{{division}}')"
